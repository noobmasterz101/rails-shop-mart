

<%= button_to "View user's orders", user_orders_path, method: :get %>

<br>
<hr>

<h2>Cart items  </h2>
<% if @shopping_cart %>
  <table>
    <thead>
      <tr>
        <th>Item ID</th>
        <th>Item Name</th>
        <th>Quantity</th>
        <th>Item Cost</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% CartItemMapping.where(shopping_cart_id: @shopping_cart.id).each do |mapping| %>
        <tr>
        <td><%= mapping.item_id %></td>
        <td><%= mapping.item_name %></td>
        <td><%= mapping.quantity %></td>
        <td><%= mapping.sub_cost %></td>
        </tr>
        <% @cart_total += mapping.sub_cost %>
      <% end %>
    </tbody>
  </table>
  <h3>
    Cart Total : <%= @cart_total %>
  </h3>
  <% if @cart_total != 0 %>
      <%= form_tag place_order_path, method: "post" do %>
          <select style="display: block;" name="coupon_code" id="coupon_code">
            <option value="5">05 % OFF </option>
            <% if @cart_total >= 500 %><option value="10">10 % OFF </option><% end %>
            <% if @cart_total >= 1000 %><option value="15">15 % OFF </option><% end %>
            <% if @cart_total >= 1500 %><option value="20">20 % OFF </option><% end %>
            <% if @cart_total >= 2000 %><option value="25">25 % OFF </option><% end %>
            <% if @cart_total >= 2500 %><option value="30">30 % OFF </option><% end %>
            <% if @cart_total >= 3000 %><option value="35">35 % OFF </option><% end %>
          </select>
        <%= hidden_field_tag :cart_total , @cart_total %>
        <%= submit_tag("Place Order") %>
      <% end %>
  <% end %>
<% end %>

<hr>

<h2>All Items</h2>

<% @items.each do |item| %>
  <div class = "card">
    <img src= <%= item.photo_url %>, style="width:250px;height:300px;">
    <div class="container">
      <h4><%= item.name %></h4>
      <p>Stocks: <%= item.stocks %><p>
      <p>Price: <%= item.price %><p>
      <%= form_with do |form| %>
        <%= form.number_field :quantity, min: 1, max: item.stocks %>
        <%= button_to 'Add to cart', home_path, method: :post, params: {id: item.id, name: item.name} %>
      <% end %>
    </div>
  </div>
  <br>
<% end %>