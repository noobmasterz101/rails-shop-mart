<h1>SHOP MART</h1>

<% if Current.user %>
    <p>Logged in as: <%= Current.user.email %></p>
    <p><%= button_to 'Logout', logout_path, method: :delete %></p>
<% end %>

<%= button_to "View user's orders", user_orders_path, method: :get %>

<br>
<hr>

<h2>Cart items  </h2>
<% if @shopping_cart %>
  <table>
    <thead>
      <tr>
        <th>Item ID</th>
        <th>Item Name</th>
        <th>Quantity</th>
        <th>Item Cost</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% CartItemMapping.where(shopping_cart_id: @shopping_cart.id).each do |mapping| %>
        <tr>
        <td><%= mapping.item_id %></td>
        <td><%= mapping.item_name %></td>
        <td><%= mapping.quantity %></td>
        <td><%= mapping.sub_cost %></td>
        </tr>
        <% @cart_total += mapping.sub_cost %>
      <% end %>
    </tbody>
  </table>
  <h3>
    Cart Total : <%= @cart_total %>
  </h3>
  <% if @cart_total != 0 %>
        <%= button_to "Place Order", place_order_path, method: :post, params: {cart_total: @cart_total} %>
        <%  @cart_total = 0 %>
  <% end %>
<% end %>

<hr>

<h2>All Items</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Photo</th>
      <th>Stocks</th>
      <th>Price</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @items.each do |item| %>
      <tr>
        <td><%= item.name %></td>
        <td><%= item.photo_url %></td>
        <td><%= item.stocks %></td>
        <td><%= item.price %></td>
        <td>
          <%= form_with do |form| %>
            <%= form.number_field :quantity %>
            <%= button_to 'Add to cart', home_path, method: :post, params: {id: item.id, name: item.name} %>
          <% end %>
        </td>        
      </tr>
    <% end %>
  </tbody>
</table>